<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Implementing a simple K8s admission controller in Go | KungFu Dev</title><meta name=keywords content="go,k8s,admissioncontroller"><meta name=description content="What is an admission controller?  In a nutshell, Kubernetes admission controllers are plugins that govern and enforce how the cluster is used. They can be thought of as a gatekeeper that intercept (authenticated) API requests and may change the request object or deny the request altogether. The admission control process has two phases: the mutating phase is executed first, followed by the validating phase.
 Kubernetes admission Controller Phases:"><meta name=author content="Me"><link rel=canonical href=https://www.kungfudev.com/posts/implementing-k8s-admission-controller/><link crossorigin=anonymous href=/assets/css/stylesheet.min.ed52a04cba0843fef8297e018b15e8a32a989ea4415133cb8bf77414d3815f7b.css integrity="sha256-7VKgTLoIQ/74KX4BixXooyqYnqRBUTPLi/d0FNOBX3s=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.4dcb3c4f38462f66c6b6137227726f5543cb934cca9788f041c087e374491df2.js integrity="sha256-Tcs8TzhGL2bGthNyJ3JvVUPLk0zKl4jwQcCH43RJHfI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://www.kungfudev.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.kungfudev.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.kungfudev.com/favicon-32x32.png><link rel=apple-touch-icon href=https://www.kungfudev.com/apple-touch-icon.png><link rel=mask-icon href=https://www.kungfudev.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://www.kungfudev.com/posts/implementing-k8s-admission-controller/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,o,i,a,t,n,s){e.GoogleAnalyticsObject=t,e[t]=e[t]||function(){(e[t].q=e[t].q||[]).push(arguments)},e[t].l=1*new Date,n=o.createElement(i),s=o.getElementsByTagName(i)[0],n.async=1,n.src=a,s.parentNode.insertBefore(n,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="Implementing a simple K8s admission controller in Go"><meta property="og:description" content="What is an admission controller?  In a nutshell, Kubernetes admission controllers are plugins that govern and enforce how the cluster is used. They can be thought of as a gatekeeper that intercept (authenticated) API requests and may change the request object or deny the request altogether. The admission control process has two phases: the mutating phase is executed first, followed by the validating phase.
 Kubernetes admission Controller Phases:"><meta property="og:type" content="article"><meta property="og:url" content="https://www.kungfudev.com/posts/implementing-k8s-admission-controller/"><meta property="og:image" content="https://d33wubrfki0l68.cloudfront.net/af21ecd38ec67b3d81c1b762221b4ac777fcf02d/7c60e/images/blog/2019-03-21-a-guide-to-kubernetes-admission-controllers/admission-controller-phases.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-03-01T00:00:00+00:00"><meta property="article:modified_time" content="2021-03-01T00:00:00+00:00"><meta property="og:site_name" content="I'm Kung Fu Dev"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://d33wubrfki0l68.cloudfront.net/af21ecd38ec67b3d81c1b762221b4ac777fcf02d/7c60e/images/blog/2019-03-21-a-guide-to-kubernetes-admission-controllers/admission-controller-phases.png"><meta name=twitter:title content="Implementing a simple K8s admission controller in Go"><meta name=twitter:description content="What is an admission controller?  In a nutshell, Kubernetes admission controllers are plugins that govern and enforce how the cluster is used. They can be thought of as a gatekeeper that intercept (authenticated) API requests and may change the request object or deny the request altogether. The admission control process has two phases: the mutating phase is executed first, followed by the validating phase.
 Kubernetes admission Controller Phases:"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://www.kungfudev.com/posts/"},{"@type":"ListItem","position":3,"name":"Implementing a simple K8s admission controller in Go","item":"https://www.kungfudev.com/posts/implementing-k8s-admission-controller/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Implementing a simple K8s admission controller in Go","name":"Implementing a simple K8s admission controller in Go","description":"What is an admission controller?  In a nutshell, Kubernetes admission controllers are plugins that govern and enforce how the cluster is used. They can be thought of as a gatekeeper that intercept (authenticated) API requests and may change the request object or deny the request altogether. The admission control process has two phases: the mutating phase is executed first, followed by the validating phase.\n Kubernetes admission Controller Phases:","keywords":["go","k8s","admissioncontroller"],"articleBody":"What is an admission controller?  In a nutshell, Kubernetes admission controllers are plugins that govern and enforce how the cluster is used. They can be thought of as a gatekeeper that intercept (authenticated) API requests and may change the request object or deny the request altogether. The admission control process has two phases: the mutating phase is executed first, followed by the validating phase.\n Kubernetes admission Controller Phases:\nAn admission controller is a piece of software that intercepts requests to the Kubernetes API server before the persistence of the object (the k8s resource such as Pod, Deployment, Service, etc…) in the etcd database, but after the request is authenticated and authorized.\nWith the admission controller, we can validate or “mutate” the resource on the incoming requests. For example, imagine the following use cases:\n You want to apply a simple security validation that none of the containers in your cluster could use the latest tag. You may want to set some default values such as annotations or labels in every resource that you deploy.  There are two types of admission controllers in Kubernetes. They are validating admission controller and mutating admission controller. Mutating admission controllers are invoked first and can “modify” objects. After all object modifications are complete, and after the incoming object is validated by the API server, validating admission controllers are invoked. They can reject requests to enforce custom policies.\n Note: I put the words “modify” and “mutate” in quotes because we don’t really modify the resource itself. We tell Kubernetes what it should modify to the object “the K8s resource” using JSON Patch format.\n A mutating admission controller can act as a mutating or validating controller. It can perform both actions to the request simultaneously. However, remember that the mutating admission controllers are executed first. To ensure that you will validate an object’s last state, you should use the validating admission controller.\nRegister our admission controller webhooks I created this repository that has all the code for this example and a simple boilerplate for an admission controller in Go GitHub.\nA cluster on which this example can be tested must be running Kubernetes 1.9.0 or above. Also it should have the admissionregistration.k8s.io/v1beta1 API enabled. You can verify that using the following command:\nkubectl api-versions ... admissionregistration.k8s.io/v1beta1 ... You should check that MutatingAdmissionWebhook and ValidatingAdmissionWebhook are activated in your cluster inspecting the kube-apiserver.\n--enable-admission-plugins=..,MutatingAdmissionWebhook,ValidatingAdmissionWebhook..\" To implement our admission controller, the Kubernetes API server needs to know when and where to send the incoming requests to our admission controller. We have to create aValidatingWebhookConfiguration or MutatingWebhookConfiguration object in Kubernetes depends on what we want.\nFor example, the following configuration is to register a ValidatingWebhookConfiguration to apply some validations to creating a Pod.\napiVersion:admissionregistration.k8s.io/v1beta1kind:ValidatingWebhookConfigurationmetadata:name:pod-validationwebhooks:- name:pod-validation.default.svcclientConfig:service:name:admission-servernamespace:defaultpath:\"/validate/pods\"caBundle:\"${CA_BUNDLE}\"rules:- operations:[\"CREATE\"]apiGroups:[\"\"]apiVersions:[\"v1\"]resources:[\"pods\"]The main parts here are:\n clientConfig: The config for our admission controller server.  service.name: The name of the service for our admission controller server. service.namespace: In what namespace our admission controller server is. service.path: The path where our admission controller will receive this webhook request.   rules: Contains the operations, resources, resources’ api versions and groups that you want to intercept  operations: The operations you wish to intercept for these resources. For example, CREATE, DELETE, UPDATED resources: The resources you want to intercept on this webhook. For example, Pods, Deployment, Service, etc. apiGroups and apiVersions of these resources.    The Kubernetes API server makes an HTTPS POST request to the given service and URL path. Since a webhook must be served via HTTPS, we need proper certificates for the server. These certificates can be self-signed, but we need Kubernetes to instruct the respective CA certificate when talking to the webhook server. For that, you see the caBundle in the configuration.\nIn the GitHub repository, you will find the demo/deploy.sh script that will create a self-signed certificates and create the webhooks in demo/webhooks.yaml for this example.\nTo correctly manage your certificates in production, you could use something like a https://cert-manager.io.\nCreate our admission controller server  Note: All the code examples here have been simplified to make them easier to read. For the full implementation, please visit the repository.\n Let’s start creating a simple HTTPS. It should have an endpoint for the path that we defined for our admission webhook.\n// http/server.go func NewServer(port string) *http.Server { // Instances hooks \tpodsValidation := pods.NewValidationHook() // Routers \tah := newAdmissionHandler() mux := http.NewServeMux() mux.Handle(\"/validate/pods\", ah.Serve(podsValidation)) // The path of the webhook for Pod validation. \treturn \u0026http.Server{ Addr: fmt.Sprintf(\":%s\", port), Handler: mux, } } // cmd/main.go func main() { // flags \t// ... \tserver := http.NewServer(port) if err := server.ListenAndServeTLS(tlscert, tlskey); err != nil { log.Errorf(\"Failed to listen and serve: %v\", err) } } Then we have to create the admissionHandler to receive all the requests from our webhooks. These requests are coming with a JSON-encoded AdmissionReview (with the Request field filled) in the request body. The response should be a JSON AdmissionReview with the Response field filled.\n// http/handlers.go  type admissionHandler struct {...} // Serve returns a http.HandlerFunc for an admission webhook func (h *admissionHandler) Serve(hook admissioncontroller.Hook) http.HandlerFunc { return func(w http.ResponseWriter, r *http.Request) { // HTTP validations \t// ... \tbody, err := io.ReadAll(r.Body) if err != nil {...} var review admission.AdmissionReview if _, _, err := h.decoder.Decode(body, nil, \u0026review); err != nil {...} result, err := hook.Execute(review.Request) if err != nil {...} admissionResponse := v1beta1.AdmissionReview{ Response: \u0026v1beta1.AdmissionResponse{ UID: review.Request.UID, Allowed: result.Allowed, Result: \u0026meta.Status{Message: result.Msg}, }, } //... \tres, err := json.Marshal(admissionResponse) if err != nil {...} w.WriteHeader(http.StatusOK) w.Write(res) } } As you noticed in the code above, our handler receives a Hook struct and invokes its Execute method to process the request. In the Hook struct, we can register an AdmitFunc for each operation allowed.\n// AdmitFunc defines how to process an admission request type AdmitFunc func(request *admission.AdmissionRequest) (*Result, error) // Hook represents the set of functions for each operation in an admission webhook. type Hook struct { Create AdmitFunc Delete AdmitFunc Update AdmitFunc Connect AdmitFunc } // Execute evaluates the request and try to execute the function for operation specified in the request. func (h *Hook) Execute(r *admission.AdmissionRequest) (*Result, error) { switch r.Operation { case admission.Create: return wrapperExecution(h.Create, r) ..... } return \u0026Result{Msg: fmt.Sprintf(\"Invalid operation: %s\", r.Operation)}, nil } Now, we are ready to just focus on our business logic. We need to write the code for the webhook that we registered.\nWe will implement the logic for our ValidatingWebhook that we registered for the CREATE operation in the Pod resource. We want to validate that none of the pod’s containers could use the latest tag in its image.\n// pods/pods.go // NewValidationHook creates a new instance of pods validation hook func NewValidationHook() admissioncontroller.Hook { return admissioncontroller.Hook{ Create: validateCreate(), } } // validateImages validates that none of the containers use the `latest` tag. func validateImages() admissioncontroller.AdmitFunc { return func(r *v1beta1.AdmissionRequest) (*admissioncontroller.Result, error) { pod, err := parsePod(r.Object.Raw) if err != nil { return \u0026admissioncontroller.Result{Msg: err.Error()}, nil } for _, c := range pod.Spec.Containers { if strings.HasSuffix(c.Image, \":latest\") { return \u0026admissioncontroller.Result{Msg: \"You cannot use the tag 'latest' in a container.\"}, nil } } return \u0026admissioncontroller.Result{Allowed: true}, nil } } Of course, this is a very basic example, and you could implement more complex validations depends on your use cases. For instance, on the repository, we have another interesting example. Using a MutattingWebhook and JSON Patch, we inject a container to our pod as a sidecar.\n Note: Istio uses a similar approach to inject its sidecar containers.\n func mutateCreate() admissioncontroller.AdmitFunc { return func(r *v1beta1.AdmissionRequest) (*admissioncontroller.Result, error) { var operations []admissioncontroller.PatchOperation pod, err := parsePod(r.Object.Raw) if err != nil { return \u0026admissioncontroller.Result{Msg: err.Error()}, nil } // Very simple logic to inject a new \"sidecar\" container. \tif pod.Namespace == \"special\" { var containers []v1.Container containers = append(containers, pod.Spec.Containers...) sideC := v1.Container{ Name: \"test-sidecar\", Image: \"busybox:stable\", Command: []string{\"sh\", \"-c\", \"while true; do echo 'I am a container injected by mutating webhook'; sleep 2; done\"}, } containers = append(containers, sideC) operations = append(operations, admissioncontroller.ReplacePatchOperation(\"/spec/containers\", containers)) } return \u0026admissioncontroller.Result{ Allowed: true, PatchOps: operations, }, nil } } Deploy and test Run demo/deploy.sh will create a self-signed CA, a certificate, and private for the server and the webhooks. It also will create the following resources:\n Secret TLS The Deployment of our admission server using the demo/deployment.yaml A Service for our admission server All the Admission webhooks   Note: demo/deploy.sh is just for develop/test environment. It was not intended for production.\n You can see all the created resources:\nkubectl get svc NAME TYPE CLUSTER-IP EXTERNAL-IP PORT(S) AGE admission-server ClusterIP 10.43.120.27  443/TCP 1h kubectl get deployment NAME READY UP-TO-DATE AVAILABLE AGE admission-server 1/1 0 1 1h kubectl get secret NAME TYPE DATA AGE admission-tls kubernetes.io/tls 2 1h kubectl get mutatingwebhookconfigurations NAME WEBHOOKS AGE pod-mutation 1 1h kubectl get validatingwebhookconfigurations NAME WEBHOOKS AGE deployment-validation 1 1h pod-validation 1 1h Now, we can test our webhook. If we try to create a Pod using the following manifest will fail.\n# demo/pods/01_fail_pod_creation_test.yamlapiVersion:v1kind:Podmetadata:name:webserverspec:containers:- name:webserverimage:nginx:latestports:- containerPort:80 Note: You can use the different manifests inside demo/pods and demo/deployments to test the validations and mutations.\n kubectl create -f pods/01_fail_pod_creation_test.yaml Error from server: error when creating \"pods/01_fail_pod_creation_test.yaml\": admission webhook \"pod-validation.default.svc\" denied the request: You cannot use the tag 'latest' in a container. Conclusion As you can see, the admission controller is a powerful feature that allows us to implement custom rules and default values to the k8s resources. It is one way you can extend the k8s behavior.\nI hope you have enjoyed this article, and any feedback will be very well received.\nIf you are a Go developer or a Kubernetes ecosystem fan and want to work on many exciting stuff. In that case, we are hiring in my team at Ubisoft.\nMany thanks.\nSome interesting links  https://kubernetes.io/blog/2019/03/21/a-guide-to-kubernetes-admission-controllers/#why-do-i-need-admission-controllers https://kubernetes.io/blog/2019/03/21/a-guide-to-kubernetes-admission-controllers https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/ https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/ http://jsonpatch.com  ","wordCount":"1615","inLanguage":"en","image":"https://d33wubrfki0l68.cloudfront.net/af21ecd38ec67b3d81c1b762221b4ac777fcf02d/7c60e/images/blog/2019-03-21-a-guide-to-kubernetes-admission-controllers/admission-controller-phases.png","datePublished":"2021-03-01T00:00:00Z","dateModified":"2021-03-01T00:00:00Z","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.kungfudev.com/posts/implementing-k8s-admission-controller/"},"publisher":{"@type":"Organization","name":"KungFu Dev","logo":{"@type":"ImageObject","url":"https://www.kungfudev.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.kungfudev.com accesskey=h title="KungFu Dev (Alt + H)">KungFu Dev</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://www.kungfudev.com/es/ title=Español aria-label=Español>Es</a></li></ul></span></div><ul id=menu><li><a href=https://www.kungfudev.com/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://www.kungfudev.com/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://www.kungfudev.com/archives/ title=Archives><span>Archives</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://www.kungfudev.com>Home</a>&nbsp;»&nbsp;<a href=https://www.kungfudev.com/posts/>Posts</a></div><h1 class=post-title>Implementing a simple K8s admission controller in Go</h1><div class=post-meta><span title="2021-03-01 00:00:00 +0000 UTC">March 1, 2021</span>&nbsp;·&nbsp;8 min&nbsp;·&nbsp;Me&nbsp;|&nbsp;<a href=https://github.com/%3cpath_to_repo%3e/content/posts/implementing-k8s-admission-controller.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><figure class=entry-cover><img loading=lazy src=https://d33wubrfki0l68.cloudfront.net/af21ecd38ec67b3d81c1b762221b4ac777fcf02d/7c60e/images/blog/2019-03-21-a-guide-to-kubernetes-admission-controllers/admission-controller-phases.png alt></figure><div class=post-content><h2 id=what-is-an-admission-controller>What is an admission controller?<a hidden class=anchor aria-hidden=true href=#what-is-an-admission-controller>#</a></h2><blockquote><p>In a nutshell, Kubernetes admission controllers are plugins that govern and enforce how the cluster is used. They can be thought of as a gatekeeper that intercept (authenticated) API requests and may change the request object or deny the request altogether. The admission control process has two phases: the mutating phase is executed first, followed by the validating phase.</p></blockquote><p>Kubernetes admission Controller Phases:</p><p><img loading=lazy src=https://d33wubrfki0l68.cloudfront.net/af21ecd38ec67b3d81c1b762221b4ac777fcf02d/7c60e/images/blog/2019-03-21-a-guide-to-kubernetes-admission-controllers/admission-controller-phases.png alt></p><p>An admission controller is a piece of software that intercepts requests to the Kubernetes API server before the persistence of the object (the k8s resource such as Pod, Deployment, Service, etc&mldr;) in the etcd database, but after the request is authenticated and authorized.</p><p>With the admission controller, we can validate or &ldquo;mutate&rdquo; the resource on the incoming requests. For example, imagine the following use cases:</p><ul><li>You want to apply a simple security validation that none of the containers in your cluster could use the <code>latest</code> tag.</li><li>You may want to set some default values such as <code>annotations</code> or <code>labels</code> in every resource that you deploy.</li></ul><p>There are two types of admission controllers in Kubernetes. They are validating admission controller and mutating admission controller. Mutating admission controllers are invoked first and can &ldquo;modify&rdquo; objects. After all object modifications are complete, and after the incoming object is validated by the API server, validating admission controllers are invoked. They can reject requests to enforce custom policies.</p><blockquote><p>Note: I put the words &ldquo;modify&rdquo; and &ldquo;mutate&rdquo; in quotes because we don&rsquo;t really modify the resource itself. We tell Kubernetes what it should modify to the object &ldquo;the K8s resource&rdquo; using JSON Patch format.</p></blockquote><p>A mutating admission controller can act as a mutating or validating controller. It can perform both actions to the request simultaneously. However, remember that the mutating admission controllers are executed first. To ensure that you will validate an object&rsquo;s last state, you should use the validating admission controller.</p><h2 id=register-our-admission-controller-webhooks>Register our admission controller webhooks<a hidden class=anchor aria-hidden=true href=#register-our-admission-controller-webhooks>#</a></h2><p>I created this repository that has all the code for this example and a simple boilerplate for an admission controller in Go <a href=https://github.com/douglasmakey/admissioncontroller>GitHub</a>.</p><p>A cluster on which this example can be tested must be running Kubernetes 1.9.0 or above. Also it should have the admissionregistration.k8s.io/v1beta1 API enabled. You can verify that using the following command:</p><pre tabindex=0><code>kubectl api-versions
...
admissionregistration.k8s.io/v1beta1
...
</code></pre><p>You should check that <code>MutatingAdmissionWebhook</code> and <code>ValidatingAdmissionWebhook</code> are activated in your cluster inspecting the <code>kube-apiserver</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>--enable-admission-plugins=..,MutatingAdmissionWebhook,ValidatingAdmissionWebhook..&#34;
</span></span></code></pre></div><p>To implement our admission controller, the Kubernetes API server needs to know when and where to send the incoming requests to our admission controller. We have to create a<code>ValidatingWebhookConfiguration</code> or <code>MutatingWebhookConfiguration</code> object in Kubernetes depends on what we want.</p><p>For example, the following configuration is to register a <code>ValidatingWebhookConfiguration</code> to apply some validations to creating a <code>Pod</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>admissionregistration.k8s.io/v1beta1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>ValidatingWebhookConfiguration</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>pod-validation</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>webhooks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>pod-validation.default.svc</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>clientConfig</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>admission-server</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>default</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;/validate/pods&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>caBundle</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;${CA_BUNDLE}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>rules</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>operations</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;CREATE&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>apiGroups</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>apiVersions</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;v1&#34;</span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&#34;pods&#34;</span><span class=p>]</span><span class=w>
</span></span></span></code></pre></div><p>The main parts here are:</p><ul><li><code>clientConfig</code>: The config for our admission controller server.<ul><li><code>service.name</code>: The name of the <code>service</code> for our admission controller server.</li><li><code>service.namespace</code>: In what namespace our admission controller server is.</li><li><code>service.path</code>: The path where our admission controller will receive this webhook request.</li></ul></li><li><code>rules</code>: Contains the operations, resources, resources&rsquo; api versions and groups that you want to intercept<ul><li><code>operations</code>: The operations you wish to intercept for these resources. For example, <code>CREATE</code>, <code>DELETE</code>, <code>UPDATED</code></li><li><code>resources</code>: The resources you want to intercept on this webhook. For example, <code>Pods</code>, <code>Deployment</code>, <code>Service</code>, etc.</li><li><code>apiGroups</code> and <code>apiVersions</code> of these resources.</li></ul></li></ul><p>The Kubernetes API server makes an HTTPS POST request to the given service and URL path. Since a webhook must be served via HTTPS, we need proper certificates for the server. These certificates can be self-signed, but we need Kubernetes to instruct the respective CA certificate when talking to the webhook server. For that, you see the <code>caBundle</code> in the configuration.</p><p>In the GitHub repository, you will find the <code>demo/deploy.sh</code> script that will create a self-signed certificates and create the webhooks in <code>demo/webhooks.yaml</code> for this example.</p><p>To correctly manage your certificates in production, you could use something like a <a href=https://cert-manager.io>https://cert-manager.io</a>.</p><h2 id=create-our-admission-controller-server>Create our admission controller server<a hidden class=anchor aria-hidden=true href=#create-our-admission-controller-server>#</a></h2><blockquote><p>Note: All the code examples here have been simplified to make them easier to read. For the full implementation, please visit the <a href=https://github.com/douglasmakey/admissioncontroller>repository</a>.</p></blockquote><p>Let’s start creating a simple HTTPS. It should have an endpoint for the path that we defined for our admission webhook.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// http/server.go
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>NewServer</span><span class=p>(</span><span class=nx>port</span> <span class=kt>string</span><span class=p>)</span> <span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Server</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// Instances hooks
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>podsValidation</span> <span class=o>:=</span> <span class=nx>pods</span><span class=p>.</span><span class=nf>NewValidationHook</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=c1>// Routers
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>ah</span> <span class=o>:=</span> <span class=nf>newAdmissionHandler</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nx>mux</span> <span class=o>:=</span> <span class=nx>http</span><span class=p>.</span><span class=nf>NewServeMux</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nx>mux</span><span class=p>.</span><span class=nf>Handle</span><span class=p>(</span><span class=s>&#34;/validate/pods&#34;</span><span class=p>,</span> <span class=nx>ah</span><span class=p>.</span><span class=nf>Serve</span><span class=p>(</span><span class=nx>podsValidation</span><span class=p>))</span> <span class=c1>// The path of the webhook for Pod validation.
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=k>return</span> <span class=o>&amp;</span><span class=nx>http</span><span class=p>.</span><span class=nx>Server</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>Addr</span><span class=p>:</span>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;:%s&#34;</span><span class=p>,</span> <span class=nx>port</span><span class=p>),</span>
</span></span><span class=line><span class=cl>		<span class=nx>Handler</span><span class=p>:</span> <span class=nx>mux</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// cmd/main.go
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// flags
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>server</span> <span class=o>:=</span> <span class=nx>http</span><span class=p>.</span><span class=nf>NewServer</span><span class=p>(</span><span class=nx>port</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>server</span><span class=p>.</span><span class=nf>ListenAndServeTLS</span><span class=p>(</span><span class=nx>tlscert</span><span class=p>,</span> <span class=nx>tlskey</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>log</span><span class=p>.</span><span class=nf>Errorf</span><span class=p>(</span><span class=s>&#34;Failed to listen and serve: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Then we have to create the <code>admissionHandler</code> to receive all the requests from our webhooks. These requests are coming with a JSON-encoded <a href=https://github.com/kubernetes/api/blob/master/admission/v1beta1/types.go#L45>AdmissionReview</a> (with the Request field filled) in the request body. The response should be a JSON AdmissionReview with the Response field filled.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// http/handlers.go
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kd>type</span> <span class=nx>admissionHandler</span> <span class=kd>struct</span> <span class=p>{</span><span class=o>...</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Serve returns a http.HandlerFunc for an admission webhook
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>h</span> <span class=o>*</span><span class=nx>admissionHandler</span><span class=p>)</span> <span class=nf>Serve</span><span class=p>(</span><span class=nx>hook</span> <span class=nx>admissioncontroller</span><span class=p>.</span><span class=nx>Hook</span><span class=p>)</span> <span class=nx>http</span><span class=p>.</span><span class=nx>HandlerFunc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=kd>func</span><span class=p>(</span><span class=nx>w</span> <span class=nx>http</span><span class=p>.</span><span class=nx>ResponseWriter</span><span class=p>,</span> <span class=nx>r</span> <span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=c1>// HTTP validations
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=c1>// ...
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=nx>body</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>io</span><span class=p>.</span><span class=nf>ReadAll</span><span class=p>(</span><span class=nx>r</span><span class=p>.</span><span class=nx>Body</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span><span class=o>...</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=kd>var</span> <span class=nx>review</span> <span class=nx>admission</span><span class=p>.</span><span class=nx>AdmissionReview</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>h</span><span class=p>.</span><span class=nx>decoder</span><span class=p>.</span><span class=nf>Decode</span><span class=p>(</span><span class=nx>body</span><span class=p>,</span> <span class=kc>nil</span><span class=p>,</span> <span class=o>&amp;</span><span class=nx>review</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span><span class=o>...</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=nx>result</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>hook</span><span class=p>.</span><span class=nf>Execute</span><span class=p>(</span><span class=nx>review</span><span class=p>.</span><span class=nx>Request</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span><span class=o>...</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=nx>admissionResponse</span> <span class=o>:=</span> <span class=nx>v1beta1</span><span class=p>.</span><span class=nx>AdmissionReview</span><span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>Response</span><span class=p>:</span> <span class=o>&amp;</span><span class=nx>v1beta1</span><span class=p>.</span><span class=nx>AdmissionResponse</span><span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=nx>UID</span><span class=p>:</span>     <span class=nx>review</span><span class=p>.</span><span class=nx>Request</span><span class=p>.</span><span class=nx>UID</span><span class=p>,</span>
</span></span><span class=line><span class=cl>				<span class=nx>Allowed</span><span class=p>:</span> <span class=nx>result</span><span class=p>.</span><span class=nx>Allowed</span><span class=p>,</span>
</span></span><span class=line><span class=cl>				<span class=nx>Result</span><span class=p>:</span>  <span class=o>&amp;</span><span class=nx>meta</span><span class=p>.</span><span class=nx>Status</span><span class=p>{</span><span class=nx>Message</span><span class=p>:</span> <span class=nx>result</span><span class=p>.</span><span class=nx>Msg</span><span class=p>},</span>
</span></span><span class=line><span class=cl>			<span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=c1>//...
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=nx>res</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>json</span><span class=p>.</span><span class=nf>Marshal</span><span class=p>(</span><span class=nx>admissionResponse</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span><span class=o>...</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=nx>w</span><span class=p>.</span><span class=nf>WriteHeader</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>w</span><span class=p>.</span><span class=nf>Write</span><span class=p>(</span><span class=nx>res</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>As you noticed in the code above, our handler receives a <code>Hook</code> struct and invokes its <code>Execute</code> method to process the request. In the <code>Hook</code> struct, we can register an <code>AdmitFunc</code> for each operation allowed.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// AdmitFunc defines how to process an admission request
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>AdmitFunc</span> <span class=kd>func</span><span class=p>(</span><span class=nx>request</span> <span class=o>*</span><span class=nx>admission</span><span class=p>.</span><span class=nx>AdmissionRequest</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>Result</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Hook represents the set of functions for each operation in an admission webhook.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>Hook</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>Create</span>  <span class=nx>AdmitFunc</span>
</span></span><span class=line><span class=cl>	<span class=nx>Delete</span>  <span class=nx>AdmitFunc</span>
</span></span><span class=line><span class=cl>	<span class=nx>Update</span>  <span class=nx>AdmitFunc</span>
</span></span><span class=line><span class=cl>	<span class=nx>Connect</span> <span class=nx>AdmitFunc</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Execute evaluates the request and try to execute the function for operation specified in the request.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>h</span> <span class=o>*</span><span class=nx>Hook</span><span class=p>)</span> <span class=nf>Execute</span><span class=p>(</span><span class=nx>r</span> <span class=o>*</span><span class=nx>admission</span><span class=p>.</span><span class=nx>AdmissionRequest</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>Result</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>switch</span> <span class=nx>r</span><span class=p>.</span><span class=nx>Operation</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>case</span> <span class=nx>admission</span><span class=p>.</span><span class=nx>Create</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nf>wrapperExecution</span><span class=p>(</span><span class=nx>h</span><span class=p>.</span><span class=nx>Create</span><span class=p>,</span> <span class=nx>r</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=o>...</span><span class=p>..</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=o>&amp;</span><span class=nx>Result</span><span class=p>{</span><span class=nx>Msg</span><span class=p>:</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;Invalid operation: %s&#34;</span><span class=p>,</span> <span class=nx>r</span><span class=p>.</span><span class=nx>Operation</span><span class=p>)},</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Now, we are ready to just focus on our business logic. We need to write the code for the webhook that we registered.</p><p>We will implement the logic for our <code>ValidatingWebhook</code> that we registered for the <code>CREATE</code> operation in the <code>Pod</code> resource. We want to validate that none of the pod&rsquo;s containers could use the <code>latest</code> tag in its image.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// pods/pods.go
</span></span></span><span class=line><span class=cl><span class=c1>// NewValidationHook creates a new instance of pods validation hook
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>NewValidationHook</span><span class=p>()</span> <span class=nx>admissioncontroller</span><span class=p>.</span><span class=nx>Hook</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>admissioncontroller</span><span class=p>.</span><span class=nx>Hook</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>Create</span><span class=p>:</span> <span class=nf>validateCreate</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// validateImages validates that none of the containers use the `latest` tag.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>validateImages</span><span class=p>()</span> <span class=nx>admissioncontroller</span><span class=p>.</span><span class=nx>AdmitFunc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=kd>func</span><span class=p>(</span><span class=nx>r</span> <span class=o>*</span><span class=nx>v1beta1</span><span class=p>.</span><span class=nx>AdmissionRequest</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>admissioncontroller</span><span class=p>.</span><span class=nx>Result</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>pod</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nf>parsePod</span><span class=p>(</span><span class=nx>r</span><span class=p>.</span><span class=nx>Object</span><span class=p>.</span><span class=nx>Raw</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=o>&amp;</span><span class=nx>admissioncontroller</span><span class=p>.</span><span class=nx>Result</span><span class=p>{</span><span class=nx>Msg</span><span class=p>:</span> <span class=nx>err</span><span class=p>.</span><span class=nf>Error</span><span class=p>()},</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>c</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>pod</span><span class=p>.</span><span class=nx>Spec</span><span class=p>.</span><span class=nx>Containers</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span> <span class=nx>strings</span><span class=p>.</span><span class=nf>HasSuffix</span><span class=p>(</span><span class=nx>c</span><span class=p>.</span><span class=nx>Image</span><span class=p>,</span> <span class=s>&#34;:latest&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=k>return</span> <span class=o>&amp;</span><span class=nx>admissioncontroller</span><span class=p>.</span><span class=nx>Result</span><span class=p>{</span><span class=nx>Msg</span><span class=p>:</span> <span class=s>&#34;You cannot use the tag &#39;latest&#39; in a container.&#34;</span><span class=p>},</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=o>&amp;</span><span class=nx>admissioncontroller</span><span class=p>.</span><span class=nx>Result</span><span class=p>{</span><span class=nx>Allowed</span><span class=p>:</span> <span class=kc>true</span><span class=p>},</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Of course, this is a very basic example, and you could implement more complex validations depends on your use cases. For instance, on the repository, we have another interesting example. Using a <code>MutattingWebhook</code> and JSON Patch, we inject a container to our pod as a sidecar.</p><blockquote><p>Note: Istio uses a similar approach to inject its sidecar containers.</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>mutateCreate</span><span class=p>()</span> <span class=nx>admissioncontroller</span><span class=p>.</span><span class=nx>AdmitFunc</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=kd>func</span><span class=p>(</span><span class=nx>r</span> <span class=o>*</span><span class=nx>v1beta1</span><span class=p>.</span><span class=nx>AdmissionRequest</span><span class=p>)</span> <span class=p>(</span><span class=o>*</span><span class=nx>admissioncontroller</span><span class=p>.</span><span class=nx>Result</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kd>var</span> <span class=nx>operations</span> <span class=p>[]</span><span class=nx>admissioncontroller</span><span class=p>.</span><span class=nx>PatchOperation</span>
</span></span><span class=line><span class=cl>		<span class=nx>pod</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nf>parsePod</span><span class=p>(</span><span class=nx>r</span><span class=p>.</span><span class=nx>Object</span><span class=p>.</span><span class=nx>Raw</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=o>&amp;</span><span class=nx>admissioncontroller</span><span class=p>.</span><span class=nx>Result</span><span class=p>{</span><span class=nx>Msg</span><span class=p>:</span> <span class=nx>err</span><span class=p>.</span><span class=nf>Error</span><span class=p>()},</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=c1>// Very simple logic to inject a new &#34;sidecar&#34; container.
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=k>if</span> <span class=nx>pod</span><span class=p>.</span><span class=nx>Namespace</span> <span class=o>==</span> <span class=s>&#34;special&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=kd>var</span> <span class=nx>containers</span> <span class=p>[]</span><span class=nx>v1</span><span class=p>.</span><span class=nx>Container</span>
</span></span><span class=line><span class=cl>			<span class=nx>containers</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>containers</span><span class=p>,</span> <span class=nx>pod</span><span class=p>.</span><span class=nx>Spec</span><span class=p>.</span><span class=nx>Containers</span><span class=o>...</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=nx>sideC</span> <span class=o>:=</span> <span class=nx>v1</span><span class=p>.</span><span class=nx>Container</span><span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=nx>Name</span><span class=p>:</span>    <span class=s>&#34;test-sidecar&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>				<span class=nx>Image</span><span class=p>:</span>   <span class=s>&#34;busybox:stable&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>				<span class=nx>Command</span><span class=p>:</span> <span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&#34;sh&#34;</span><span class=p>,</span> <span class=s>&#34;-c&#34;</span><span class=p>,</span> <span class=s>&#34;while true; do echo &#39;I am a container injected by mutating webhook&#39;; sleep 2; done&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>			<span class=nx>containers</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>containers</span><span class=p>,</span> <span class=nx>sideC</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=nx>operations</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>operations</span><span class=p>,</span> <span class=nx>admissioncontroller</span><span class=p>.</span><span class=nf>ReplacePatchOperation</span><span class=p>(</span><span class=s>&#34;/spec/containers&#34;</span><span class=p>,</span> <span class=nx>containers</span><span class=p>))</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=o>&amp;</span><span class=nx>admissioncontroller</span><span class=p>.</span><span class=nx>Result</span><span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>Allowed</span><span class=p>:</span>  <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>			<span class=nx>PatchOps</span><span class=p>:</span> <span class=nx>operations</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=p>},</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=deploy-and-test>Deploy and test<a hidden class=anchor aria-hidden=true href=#deploy-and-test>#</a></h2><p>Run <code>demo/deploy.sh</code> will create a self-signed CA, a certificate, and private for the server and the webhooks. It also will create the following resources:</p><ul><li>Secret TLS</li><li>The Deployment of our admission server using the <code>demo/deployment.yaml</code></li><li>A Service for our admission server</li><li>All the Admission webhooks</li></ul><blockquote><p>Note: demo/deploy.sh is just for develop/test environment. It was not intended for production.</p></blockquote><p>You can see all the created resources:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>kubectl get svc
</span></span><span class=line><span class=cl>NAME               TYPE        CLUSTER-IP     EXTERNAL-IP   PORT<span class=o>(</span>S<span class=o>)</span>   AGE
</span></span><span class=line><span class=cl>admission-server   ClusterIP   10.43.120.27   &lt;none&gt;        443/TCP   1h
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>kubectl get deployment
</span></span><span class=line><span class=cl>NAME               READY   UP-TO-DATE   AVAILABLE   AGE
</span></span><span class=line><span class=cl>admission-server   1/1     <span class=m>0</span>            <span class=m>1</span>           1h
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>kubectl get secret
</span></span><span class=line><span class=cl>NAME                  TYPE                                  DATA   AGE
</span></span><span class=line><span class=cl>admission-tls         kubernetes.io/tls                     <span class=m>2</span>      1h
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>kubectl get mutatingwebhookconfigurations
</span></span><span class=line><span class=cl>NAME           WEBHOOKS   AGE
</span></span><span class=line><span class=cl>pod-mutation   <span class=m>1</span>          1h
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>kubectl get validatingwebhookconfigurations
</span></span><span class=line><span class=cl>NAME                    WEBHOOKS   AGE
</span></span><span class=line><span class=cl>deployment-validation   <span class=m>1</span>          1h
</span></span><span class=line><span class=cl>pod-validation          <span class=m>1</span>          1h
</span></span></code></pre></div><p>Now, we can test our webhook. If we try to create a <code>Pod</code> using the following manifest will fail.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># demo/pods/01_fail_pod_creation_test.yaml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>webserver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>webserver</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx:latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span>- <span class=nt>containerPort</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></span></span></code></pre></div><blockquote><p>Note: You can use the different manifests inside <code>demo/pods</code> and <code>demo/deployments</code> to test the validations and mutations.</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl> kubectl create -f pods/01_fail_pod_creation_test.yaml
</span></span><span class=line><span class=cl>Error from server: error when creating <span class=s2>&#34;pods/01_fail_pod_creation_test.yaml&#34;</span>: admission webhook <span class=s2>&#34;pod-validation.default.svc&#34;</span> denied the request: You cannot use the tag <span class=s1>&#39;latest&#39;</span> in a container.
</span></span></code></pre></div><h2 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h2><p>As you can see, the admission controller is a powerful feature that allows us to implement custom rules and default values to the k8s resources. It is one way you can extend the k8s behavior.</p><p>I hope you have enjoyed this article, and any feedback will be very well received.</p><p>If you are a Go developer or a Kubernetes ecosystem fan and want to work on many exciting stuff. In that case, we are hiring in my team at <a href="https://jobs.smartrecruiters.com/Ubisoft2/743999727156666-kubernetes-sre-specialist-ubisoft-kubernetes-service?trid=4556ca14-794c-4023-bd62-6813e288177e">Ubisoft</a>.</p><p>Many thanks.</p><h3 id=some-interesting-links>Some interesting links<a hidden class=anchor aria-hidden=true href=#some-interesting-links>#</a></h3><ul><li><a href=https://kubernetes.io/blog/2019/03/21/a-guide-to-kubernetes-admission-controllers/#why-do-i-need-admission-controllers>https://kubernetes.io/blog/2019/03/21/a-guide-to-kubernetes-admission-controllers/#why-do-i-need-admission-controllers</a></li><li><a href=https://kubernetes.io/blog/2019/03/21/a-guide-to-kubernetes-admission-controllers>https://kubernetes.io/blog/2019/03/21/a-guide-to-kubernetes-admission-controllers</a></li><li><a href=https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/>https://kubernetes.io/docs/reference/access-authn-authz/extensible-admission-controllers/</a></li><li><a href=https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/>https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/</a></li><li><a href=http://jsonpatch.com>http://jsonpatch.com</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.kungfudev.com/tags/go/>go</a></li><li><a href=https://www.kungfudev.com/tags/k8s/>k8s</a></li><li><a href=https://www.kungfudev.com/tags/admissioncontroller/>admissioncontroller</a></li></ul><nav class=paginav><a class=prev href=https://www.kungfudev.com/posts/socket-sharding-go/><span class=title>« Prev Page</span><br><span>Socket sharding in Linux example with Go</span></a>
<a class=next href=https://www.kungfudev.com/posts/how-to-setup-simple-load-balancing-with-ipvs-demo-with-docker/><span class=title>Next Page »</span><br><span>How to setup simple load balancing with IPVS, demo with docker</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Implementing a simple K8s admission controller in Go on twitter" href="https://twitter.com/intent/tweet/?text=Implementing%20a%20simple%20K8s%20admission%20controller%20in%20Go&url=https%3a%2f%2fwww.kungfudev.com%2fposts%2fimplementing-k8s-admission-controller%2f&hashtags=go%2ck8s%2cadmissioncontroller"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Implementing a simple K8s admission controller in Go on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fwww.kungfudev.com%2fposts%2fimplementing-k8s-admission-controller%2f&title=Implementing%20a%20simple%20K8s%20admission%20controller%20in%20Go&summary=Implementing%20a%20simple%20K8s%20admission%20controller%20in%20Go&source=https%3a%2f%2fwww.kungfudev.com%2fposts%2fimplementing-k8s-admission-controller%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Implementing a simple K8s admission controller in Go on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwww.kungfudev.com%2fposts%2fimplementing-k8s-admission-controller%2f&title=Implementing%20a%20simple%20K8s%20admission%20controller%20in%20Go"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Implementing a simple K8s admission controller in Go on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.kungfudev.com%2fposts%2fimplementing-k8s-admission-controller%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Implementing a simple K8s admission controller in Go on whatsapp" href="https://api.whatsapp.com/send?text=Implementing%20a%20simple%20K8s%20admission%20controller%20in%20Go%20-%20https%3a%2f%2fwww.kungfudev.com%2fposts%2fimplementing-k8s-admission-controller%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Implementing a simple K8s admission controller in Go on telegram" href="https://telegram.me/share/url?text=Implementing%20a%20simple%20K8s%20admission%20controller%20in%20Go&url=https%3a%2f%2fwww.kungfudev.com%2fposts%2fimplementing-k8s-admission-controller%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://www.kungfudev.com>KungFu Dev</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script src=https://getinsights.io/js/insights.js></script>
<script>insights.init("GdLATB2pvNG_hxRs"),insights.trackPages()</script></body></html>