<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Tracking Service with Go and Redis V2 | KungFu Developer</title><meta name=keywords content="go,redis,tracking,services"><meta name=description content="Do you remember my last article where I wrote a service to look for a driver like uber? If not, you can check here So now, we going to write the V2 of our service.
The current state of our service, when a user consumes the resource &lsquo;search&rsquo;, the user receives a response with the closer driver to him. But what would happen if there are no drivers close to the user?"><meta name=author content="Me"><link rel=canonical href=https://www.kungfudev.com/posts/tracking-service-v2/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://www.kungfudev.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.kungfudev.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.kungfudev.com/favicon-32x32.png><link rel=apple-touch-icon href=https://www.kungfudev.com/apple-touch-icon.png><link rel=mask-icon href=https://www.kungfudev.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://www.kungfudev.com/posts/tracking-service-v2/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="Tracking Service with Go and Redis V2"><meta property="og:description" content="Do you remember my last article where I wrote a service to look for a driver like uber? If not, you can check here So now, we going to write the V2 of our service.
The current state of our service, when a user consumes the resource &lsquo;search&rsquo;, the user receives a response with the closer driver to him. But what would happen if there are no drivers close to the user?"><meta property="og:type" content="article"><meta property="og:url" content="https://www.kungfudev.com/posts/tracking-service-v2/"><meta property="og:image" content="https://www.kungfudev.com/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-10-05T00:00:00+00:00"><meta property="article:modified_time" content="2018-10-05T00:00:00+00:00"><meta property="og:site_name" content="I'm a Kung Fu Deveveloper"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.kungfudev.com/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Tracking Service with Go and Redis V2"><meta name=twitter:description content="Do you remember my last article where I wrote a service to look for a driver like uber? If not, you can check here So now, we going to write the V2 of our service.
The current state of our service, when a user consumes the resource &lsquo;search&rsquo;, the user receives a response with the closer driver to him. But what would happen if there are no drivers close to the user?"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://www.kungfudev.com/posts/"},{"@type":"ListItem","position":3,"name":"Tracking Service with Go and Redis V2","item":"https://www.kungfudev.com/posts/tracking-service-v2/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Tracking Service with Go and Redis V2","name":"Tracking Service with Go and Redis V2","description":"Do you remember my last article where I wrote a service to look for a driver like uber? If not, you can check here So now, we going to write the V2 of our service.\nThe current state of our service, when a user consumes the resource \u0026lsquo;search\u0026rsquo;, the user receives a response with the closer driver to him. But what would happen if there are no drivers close to the user?","keywords":["go","redis","tracking","services"],"articleBody":"Do you remember my last article where I wrote a service to look for a driver like uber? If not, you can check here So now, we going to write the V2 of our service.\nThe current state of our service, when a user consumes the resource ‘search’, the user receives a response with the closer driver to him. But what would happen if there are no drivers close to the user? We don’t want the service client doing a big amount of requests to the same endpoint to look for a driver. What we want to do is to follow the pattern Uber uses and that is that our client makes only one request and this request raises a task that looks for a driver to us for X time and, later on, the user receives the result.\nFor doing this we are going to use some of the tools Go provides us: Goroutines, Channels and time.Ticker struct.\nNOTE: This will be a basic implementation.\nGoroutine A goroutine is a lightweight, costing little more than the allocation of stack space. And the stacks start small, so they are cheap, and grow by allocating (and freeing) heap storage as required.\nTo run a function as a goroutine, just simply put the keyword go before a func call. When the func is done, the goroutine exits, silently.\ngo list.Sort() // run list.Sort concurrently; don't wait for it. NOTE: Goroutines run in the same address space, so access to shared memory must be synchronized. The sync package provides useful primitives, although you won’t need them much in Go as there are other primitives.\nEffective Go - Goroutines Channels Channels are a typed conduit through which you can send and receive values with the channel operator, \u003c-.\nch \u003c- v // Send v to channel ch. v := \u003c-ch // Receive from ch, and // assign value to v. (The data flows in the direction of the arrow.)\nLike maps, channels are allocated with make, and the resulting value acts as a reference to an underlying data structure. If an optional integer parameter is provided, it sets the buffer size for the channel. The default is zero, for an unbuffered or synchronous channel.\nci := make(chan int) // unbuffered channel of integers cj := make(chan int, 0) // unbuffered channel of integers cs := make(chan *os.File, 100) // buffered channel of pointers to Files Unbuffered channels combine communication—the exchange of a value—with synchronization—guaranteeing that two calculations (goroutines) are in a known state.\nThere are lots of nice idioms using channels. Here’s one to get us started. In the previous section we launched a sort in the background. A channel can allow the launching goroutine to wait for the sort to complete.\nc := make(chan int) // Allocate a channel. // Start the sort in a goroutine; when it completes, signal on the channel. go func() { list.Sort() c \u003c- 1 // Send a signal; value does not matter. }() doSomethingForAWhile() \u003c-c // Wait for sort to finish; discard sent value. Receivers always block until there is data to receive. If the channel is unbuffered, the sender blocks until the receiver has received the value. If the channel has a buffer, the sender blocks only until the value has been copied to the buffer; if the buffer is full, this means waiting until some receiver has retrieved a value.\nEffective Go - Channels time.Ticker Timers are for when you want to do something once in the future - tickers are for when you want to do something repeatedly at regular intervals. Here’s an example of a ticker that ticks periodically until we stop it.\npackage main import \"time\" import \"fmt\" func main() { // Tickers use a similar mechanism to timers: a // channel that is sent values. Here we'll use the // `range` builtin on the channel to iterate over // the values as they arrive every 500ms. ticker := time.NewTicker(500 * time.Millisecond) go func() { for t := range ticker.C { fmt.Println(\"Tick at\", t) } }() // Tickers can be stopped like timers. Once a ticker // is stopped it won't receive any more values on its // channel. We'll stop ours after 1600ms. time.Sleep(1600 * time.Millisecond) ticker.Stop() fmt.Println(\"Ticker stopped\") } Let’s start coding First, we will create a new folder called tasks, inside we create a ‘request.go’ that contains the code to do the search.\n// FILE: tasks/search.go // These are the reasons which a request is invalid. var ( ErrExpired = errors.New(\"request expired\") ErrCanceled = errors.New(\"request canceled\") ) // RequestDriverTask is a simple struct that contains info about the user, request and driver, you can add more information if you want. type RequestDriverTask struct { ID string UserID string Lat, Lng float64 DriverID string } // NewRequestDriverTask create and return a pointer to RequestDriverTask func NewRequestDriverTask(id, userID string, lat, lng float64) *RequestDriverTask { return \u0026RequestDriverTask{ ID: id, UserID: userID, Lat:lat, Lng:lng, } } We implement the Run method, this func will be launched from the handler.\n// FILE: tasks/search.go // Run is the function for executing the task, this task validating the request and launches another goroutine called 'doSearch' which does the search. func (r *RequestDriverTask) Run() { // We create a new ticker with 30s time duration, this it means that each 30s the task executes the search for a driver. ticker := time.NewTicker(time.Second * 30) // With the done channel, we receive if the driver was found done := make(chan struct{}) for { // The select statement lets a goroutine wait on multiple communication operations. select { case \u003c-ticker.C: err := r.validateRequest() switch err { case nil: log.Println(fmt.Sprintf(\"Search Driver - Request %s for Lat: %f and Lng: %f\", r.ID, r.Lat, r.Lng)) go r.doSearch(done) case ErrExpired: // Notify to user that the request expired. sendInfo(r, \"Sorry, we did not find any driver.\") return case ErrCanceled: log.Printf(\"Request %s has been canceled. \", r.ID) return default: // defensive programming: expected the unexpected log.Printf(\"unexpected error: %v\", err) return } case _, ok := \u003c-done: if !ok { sendInfo(r, fmt.Sprintf(\"Driver %s found\", r.DriverID)) ticker.Stop() return } } } } Ok, now we going to create two methods for RequestDriverTask.\nThe first method is validateRequest, this function validates the key, if the key is active or if the key expired and will return error like a reason if the request is not valid.\nThe second method is doSearch, this function uses our RedisClient and its function SearchDrivers for doing search.\n// FILE: tasks/search.go // validateRequest validates if the request is valid and return an error like a reason in case not. func (r *RequestDriverTask) validateRequest() error { rClient := storages.GetRedisClient() keyValue, err := rClient.Get(r.ID).Result() if err != nil { // Request has been expired. return ErrExpired } isActive, _ := strconv.ParseBool(keyValue) if !isActive { // Request has been canceled. return ErrCanceled } return nil } // doSearch do search of driver and close to the channel. func (r *RequestDriverTask) doSearch(done chan struct{}) { rClient := storages.GetRedisClient() drivers := rClient.SearchDrivers(1, r.Lat, r.Lng, 5) if len(drivers) == 1 { // Driver found // Remove driver location, we can send a message to the driver for that it does not send again its location to this service. rClient.RemoveDriverLocation(drivers[0].Name) r.DriverID = drivers[0].Name close(done) } return } the function sendInfo is just example, you can implement another service or push notification or WebSocket if you want, I want to write another article where I implement an example using FCM with a little library that I wrote go-fcm to notify the user.\n// sendInfo this func is only example, you can use another services, websocket or push notification for send data to user. func sendInfo(r *RequestDriverTask, message string) { log.Println(\"Message to user:\", r.UserID) log.Println(message) } Ok, we already have the functions for the search task, now we need to create the new endpoints for our service, we going to create a new folder into handler called ‘v2’ and inside we create ‘search.go’\n// FILE: handler/v2/search.go func SearchV2(w http.ResponseWriter, r *http.Request) { rClient := storages.GetRedisClient() // We use Redis to keep a key unique for each request. // With this key also we will know if the request is active or if the user canceled the request. requestID, err := rClient.Incr(\"request_id\").Result() if err != nil { return } key := strconv.Itoa(int(requestID)) // Set true value for the key and also the expiration time, this expiration time is the duration that has the request to find a driver. rClient.Set(key, true, time.Minute*4) body := struct { Lat, Lng float64 }{} if err := json.NewDecoder(r.Body).Decode(\u0026body); err != nil { log.Printf(\"could not decode request: %v\", err) http.Error(w, \"could not decode request\", http.StatusInternalServerError) return } // We create a new task and launch with a goroutine. rTask := tasks.NewRequestDriverTask(key, fmt.Sprintf(\"requestor_%s\", key), body.Lat, body.Lng) go rTask.Run() // Return 200 and request_id w.WriteHeader(http.StatusOK) w.Write([]byte(fmt.Sprintf(`{\"request_id\": %s}`, key))) } Next, we create the handler for endpoint ‘v2/cancel’ to cancel the request, because if the user doesn’t want to wait for the search it can cancel the request.\n// FILE: handler/v2/search.go func CancelRequest(w http.ResponseWriter, r *http.Request) { rClient := storages.GetRedisClient() body := struct { RequestID string `json:\"request_id\"` }{} if err := json.NewDecoder(r.Body).Decode(\u0026body); err != nil { log.Printf(\"could not decode request: %v\", err) http.Error(w, \"could not decode request\", http.StatusInternalServerError) return } rClient.Set(body.RequestID, false, time.Minute*1) w.WriteHeader(http.StatusOK) return } Finally, we need to add new endpoints to our routes.\n// FILE: handler/base.go import ( \"net/http\" \"github.com/douglasmakey/tracking/handler/v2\" ) func NewHandler() *http.ServeMux { mux := http.NewServeMux() mux.HandleFunc(\"/tracking\", tracking) mux.HandleFunc(\"/search\", search) //V2 mux.HandleFunc(\"/v2/search\", v2.SearchV2) mux.HandleFunc(\"/v2/cancel\", v2.CancelRequest) return mux } Example Look up for the nearest driver\ncurl -i --header \"Content-Type: application/json\" --data '{\"lat\": -33.44262, \"lng\": -70.63054}' http://localhost:8000/v2/search HTTP/1.1 200 OK Date: Sat, 29 Sep 2018 15:33:48 GMT Content-Length: 17 Content-Type: application/json {\"request_id\": 1} But if drivers are not close client location and pass 4 minutes or the time duration that we set, the request will be expired without finding any drivers.\nServer Log\n2018/09/30 01:57:53 Starting HTTP Server. Listening at \":8000\" Search Driver - Request 1 for Lat: -33.442620 and Lng: -70.630540 Search Driver - Request 1 for Lat: -33.442620 and Lng: -70.630540 Search Driver - Request 1 for Lat: -33.442620 and Lng: -70.630540 Search Driver - Request 1 for Lat: -33.442620 and Lng: -70.630540 Search Driver - Request 1 for Lat: -33.442620 and Lng: -70.630540 Search Driver - Request 1 for Lat: -33.442620 and Lng: -70.630540 Search Driver - Request 1 for Lat: -33.442620 and Lng: -70.630540 Search Driver - Request 1 for Lat: -33.442620 and Lng: -70.630540 Message to user: requestor_1 Sorry, we did not find any driver. We going to do another request to ‘v2/search’, but after 1 minute in another terminal, we send driver location to service.\n// Another Terminal curl -i --header \"Content-Type: application/json\" --data '{\"id\": \"1\", \"lat\": -33.44091, \"lng\": -70.6301}' http://localhost:8000/tracking // Terminal with main 2018/09/30 02:12:03 Starting HTTP Server. Listening at \":8000\" 2018/09/30 02:12:38 Search Driver - Request 2 for Lat: -33.442620 and Lng: -70.630540 2018/09/30 02:13:08 Search Driver - Request 2 for Lat: -33.442620 and Lng: -70.630540 2018/09/30 02:13:38 Search Driver - Request 2 for Lat: -33.442620 and Lng: -70.630540 2018/09/30 02:13:38 Message to user: requestor_2 2018/09/30 02:13:38 Driver 1 found Ok, now we going to do another request to ‘v2/search’, but this time we going to do a request to ‘v2/cancel’ to cancel the order because we can not wait.\n// Another Terminal curl -i --header \"Content-Type: application/json\" --data '{\"request_id\": \"3\"}' http://localhost:8000/v2/cancel // Terminal with main 2018/09/30 02:19:24 Starting HTTP Server. Listening at \":8000\" 2018/09/30 02:19:56 Search Driver - Request 3 for Lat: -33.442620 and Lng: -70.630540 2018/09/30 02:19:56 Request 3 has been canceled. ","wordCount":"1926","inLanguage":"en","datePublished":"2018-10-05T00:00:00Z","dateModified":"2018-10-05T00:00:00Z","author":{"@type":"Person","name":"Me"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.kungfudev.com/posts/tracking-service-v2/"},"publisher":{"@type":"Organization","name":"KungFu Developer","logo":{"@type":"ImageObject","url":"https://www.kungfudev.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.kungfudev.com accesskey=h title="KungFu Developer (Alt + H)">KungFu Developer</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://www.kungfudev.com/es/ title=Español aria-label=Español>Es</a></li></ul></div></div><ul id=menu><li><a href=https://www.kungfudev.com/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://www.kungfudev.com/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://www.kungfudev.com/archives/ title=Archives><span>Archives</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://www.kungfudev.com>Home</a>&nbsp;»&nbsp;<a href=https://www.kungfudev.com/posts/>Posts</a></div><h1 class=post-title>Tracking Service with Go and Redis V2</h1><div class=post-meta><span title='2018-10-05 00:00:00 +0000 UTC'>October 5, 2018</span>&nbsp;·&nbsp;10 min&nbsp;·&nbsp;Me</div></header><div class=post-content><p>Do you remember my last article where I wrote a service to look for a driver like uber? If not, you can check <a href=https://dev.to/douglasmakey/tracking-service-with-go-and-redis-43mm>here</a> So now, we going to write the V2 of our service.</p><p>The current state of our service, when a user consumes the resource &lsquo;search&rsquo;, the user receives a response with the closer driver to him. But what would happen if there are no drivers close to the user? We don&rsquo;t want the service client doing a big amount of requests to the same endpoint to look for a driver. What we want to do is to follow the pattern Uber uses and that is that our client makes only one request and this request raises a task that looks for a driver to us for X time and, later on, the user receives the result.</p><p>For doing this we are going to use some of the tools Go provides us: Goroutines, Channels and time.Ticker struct.</p><p><strong>NOTE: This will be a basic implementation.</strong></p><h2 id=goroutine>Goroutine<a hidden class=anchor aria-hidden=true href=#goroutine>#</a></h2><p><del>A goroutine is a lightweight, costing little more than the allocation of stack space. And the stacks start small, so they are cheap, and grow by allocating (and freeing) heap storage as required.</del></p><p>To run a function as a goroutine, just simply put the keyword <code>go</code> before a func call. When the func is done, the goroutine exits, silently.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=k>go</span> <span class=nx>list</span><span class=p>.</span><span class=nf>Sort</span><span class=p>()</span>  <span class=c1>// run list.Sort concurrently; don&#39;t wait for it.
</span></span></span></code></pre></div><p>NOTE: Goroutines run in the same address space, so access to shared memory must be synchronized. The sync package provides useful primitives, although you won&rsquo;t need them much in Go as there are other primitives.</p><p><a href=https://golang.org/doc/effective_go.html?#goroutines>Effective Go - Goroutines</a></p><h2 id=channels>Channels<a hidden class=anchor aria-hidden=true href=#channels>#</a></h2><p><del>Channels are a typed conduit through which you can send and receive values with the channel operator, &lt;-.</del></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>ch</span> <span class=o>&lt;-</span> <span class=nx>v</span>    <span class=c1>// Send v to channel ch.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>v</span> <span class=o>:=</span> <span class=o>&lt;-</span><span class=nx>ch</span>  <span class=c1>// Receive from ch, and
</span></span></span><span class=line><span class=cl><span class=c1></span>           <span class=c1>// assign value to v.
</span></span></span></code></pre></div><p>(The data flows in the direction of the arrow.)</p><p>Like maps, channels are allocated with make, and the resulting value acts as a reference to an underlying data structure. If an optional integer parameter is provided, it sets the buffer size for the channel. The default is zero, for an unbuffered or synchronous channel.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>ci</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=kt>int</span><span class=p>)</span>            <span class=c1>// unbuffered channel of integers
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>cj</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=kt>int</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>         <span class=c1>// unbuffered channel of integers
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>cs</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=o>*</span><span class=nx>os</span><span class=p>.</span><span class=nx>File</span><span class=p>,</span> <span class=mi>100</span><span class=p>)</span>  <span class=c1>// buffered channel of pointers to Files
</span></span></span></code></pre></div><p>Unbuffered channels combine communication—the exchange of a value—with synchronization—guaranteeing that two calculations (goroutines) are in a known state.</p><p>There are lots of nice idioms using channels. Here&rsquo;s one to get us started. In the previous section we launched a sort in the background. A channel can allow the launching goroutine to wait for the sort to complete.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>c</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=kt>int</span><span class=p>)</span>  <span class=c1>// Allocate a channel.
</span></span></span><span class=line><span class=cl><span class=c1>// Start the sort in a goroutine; when it completes, signal on the channel.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>go</span> <span class=kd>func</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>list</span><span class=p>.</span><span class=nf>Sort</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>c</span> <span class=o>&lt;-</span> <span class=mi>1</span>  <span class=c1>// Send a signal; value does not matter.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}()</span>
</span></span><span class=line><span class=cl><span class=nf>doSomethingForAWhile</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=o>&lt;-</span><span class=nx>c</span>   <span class=c1>// Wait for sort to finish; discard sent value.
</span></span></span></code></pre></div><p>Receivers always block until there is data to receive. If the channel is unbuffered, the sender blocks until the receiver has received the value. If the channel has a buffer, the sender blocks only until the value has been copied to the buffer; if the buffer is full, this means waiting until some receiver has retrieved a value.</p><p><a href=https://golang.org/doc/effective_go.html?#channels>Effective Go - Channels</a></p><h2 id=timeticker>time.Ticker<a hidden class=anchor aria-hidden=true href=#timeticker>#</a></h2><p>Timers are for when you want to do something once in the future - tickers are for when you want to do something repeatedly at regular intervals. Here’s an example of a ticker that ticks periodically until we stop it.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;time&#34;</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=s>&#34;fmt&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Tickers use a similar mechanism to timers: a
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// channel that is sent values. Here we&#39;ll use the
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// `range` builtin on the channel to iterate over
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// the values as they arrive every 500ms.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>ticker</span> <span class=o>:=</span> <span class=nx>time</span><span class=p>.</span><span class=nf>NewTicker</span><span class=p>(</span><span class=mi>500</span> <span class=o>*</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Millisecond</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>go</span> <span class=kd>func</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=nx>t</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>ticker</span><span class=p>.</span><span class=nx>C</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Tick at&#34;</span><span class=p>,</span> <span class=nx>t</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Tickers can be stopped like timers. Once a ticker
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// is stopped it won&#39;t receive any more values on its
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// channel. We&#39;ll stop ours after 1600ms.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nx>time</span><span class=p>.</span><span class=nf>Sleep</span><span class=p>(</span><span class=mi>1600</span> <span class=o>*</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Millisecond</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=nx>ticker</span><span class=p>.</span><span class=nf>Stop</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Ticker stopped&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h1 id=lets-start-coding>Let&rsquo;s start coding<a hidden class=anchor aria-hidden=true href=#lets-start-coding>#</a></h1><p>First, we will create a new folder called tasks, inside we create a &lsquo;request.go&rsquo; that contains the code to do the search.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// FILE: tasks/search.go
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// These are the reasons which a request is invalid.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>var</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=nx>ErrExpired</span>  <span class=p>=</span> <span class=nx>errors</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=s>&#34;request expired&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>ErrCanceled</span> <span class=p>=</span> <span class=nx>errors</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=s>&#34;request canceled&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// RequestDriverTask is a simple struct that contains info about the user, request and driver, you can add more information if you want.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>type</span> <span class=nx>RequestDriverTask</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>ID</span>       <span class=kt>string</span>
</span></span><span class=line><span class=cl>	<span class=nx>UserID</span>   <span class=kt>string</span>
</span></span><span class=line><span class=cl>	<span class=nx>Lat</span><span class=p>,</span> <span class=nx>Lng</span> <span class=kt>float64</span>
</span></span><span class=line><span class=cl>	<span class=nx>DriverID</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// NewRequestDriverTask create and return a pointer to RequestDriverTask
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>NewRequestDriverTask</span><span class=p>(</span><span class=nx>id</span><span class=p>,</span> <span class=nx>userID</span> <span class=kt>string</span><span class=p>,</span> <span class=nx>lat</span><span class=p>,</span> <span class=nx>lng</span> <span class=kt>float64</span><span class=p>)</span> <span class=o>*</span><span class=nx>RequestDriverTask</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=o>&amp;</span><span class=nx>RequestDriverTask</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>ID</span><span class=p>:</span>     <span class=nx>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>UserID</span><span class=p>:</span> <span class=nx>userID</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>Lat</span><span class=p>:</span><span class=nx>lat</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>Lng</span><span class=p>:</span><span class=nx>lng</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>We implement the <strong>Run</strong> method, this func will be launched from the handler.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// FILE: tasks/search.go
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// Run is the function for executing the task, this task validating the request and launches another goroutine called &#39;doSearch&#39; which does the search.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>r</span> <span class=o>*</span><span class=nx>RequestDriverTask</span><span class=p>)</span> <span class=nf>Run</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// We create a new ticker with 30s time duration, this it means that each 30s the task executes the search for a driver.
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>ticker</span> <span class=o>:=</span> <span class=nx>time</span><span class=p>.</span><span class=nf>NewTicker</span><span class=p>(</span><span class=nx>time</span><span class=p>.</span><span class=nx>Second</span> <span class=o>*</span> <span class=mi>30</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// With the done channel, we receive if the driver was found
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>done</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>(</span><span class=kd>chan</span> <span class=kd>struct</span><span class=p>{})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=c1>// The select statement lets a goroutine wait on multiple communication operations.
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=k>select</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>case</span> <span class=o>&lt;-</span><span class=nx>ticker</span><span class=p>.</span><span class=nx>C</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=nx>err</span> <span class=o>:=</span> <span class=nx>r</span><span class=p>.</span><span class=nf>validateRequest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>			<span class=k>switch</span> <span class=nx>err</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>case</span> <span class=kc>nil</span><span class=p>:</span>
</span></span><span class=line><span class=cl>				<span class=nx>log</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;Search Driver - Request %s for Lat: %f and Lng: %f&#34;</span><span class=p>,</span> <span class=nx>r</span><span class=p>.</span><span class=nx>ID</span><span class=p>,</span> <span class=nx>r</span><span class=p>.</span><span class=nx>Lat</span><span class=p>,</span> <span class=nx>r</span><span class=p>.</span><span class=nx>Lng</span><span class=p>))</span>
</span></span><span class=line><span class=cl>				<span class=k>go</span> <span class=nx>r</span><span class=p>.</span><span class=nf>doSearch</span><span class=p>(</span><span class=nx>done</span><span class=p>)</span>
</span></span><span class=line><span class=cl>			<span class=k>case</span> <span class=nx>ErrExpired</span><span class=p>:</span>
</span></span><span class=line><span class=cl>				<span class=c1>// Notify to user that the request expired.
</span></span></span><span class=line><span class=cl><span class=c1></span>				<span class=nf>sendInfo</span><span class=p>(</span><span class=nx>r</span><span class=p>,</span> <span class=s>&#34;Sorry, we did not find any driver.&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>				<span class=k>return</span>
</span></span><span class=line><span class=cl>			<span class=k>case</span> <span class=nx>ErrCanceled</span><span class=p>:</span>
</span></span><span class=line><span class=cl>				<span class=nx>log</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;Request %s has been canceled. &#34;</span><span class=p>,</span> <span class=nx>r</span><span class=p>.</span><span class=nx>ID</span><span class=p>)</span>
</span></span><span class=line><span class=cl>				<span class=k>return</span>
</span></span><span class=line><span class=cl>			<span class=k>default</span><span class=p>:</span> <span class=c1>// defensive programming: expected the unexpected
</span></span></span><span class=line><span class=cl><span class=c1></span>				<span class=nx>log</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;unexpected error: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>				<span class=k>return</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=k>case</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>ok</span> <span class=o>:=</span> <span class=o>&lt;-</span><span class=nx>done</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=k>if</span> <span class=p>!</span><span class=nx>ok</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>				<span class=nf>sendInfo</span><span class=p>(</span><span class=nx>r</span><span class=p>,</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;Driver %s found&#34;</span><span class=p>,</span> <span class=nx>r</span><span class=p>.</span><span class=nx>DriverID</span><span class=p>))</span>
</span></span><span class=line><span class=cl>				<span class=nx>ticker</span><span class=p>.</span><span class=nf>Stop</span><span class=p>()</span>
</span></span><span class=line><span class=cl>				<span class=k>return</span>
</span></span><span class=line><span class=cl>			<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Ok, now we going to create two methods for RequestDriverTask.</p><p>The first method is <strong>validateRequest</strong>, this function validates the key, if the key is active or if the key expired and will return error like a reason if the request is not valid.</p><p>The second method is <strong>doSearch</strong>, this function uses our RedisClient and its function SearchDrivers for doing search.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// FILE: tasks/search.go
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=c1>// validateRequest validates if the request is valid and return an error like a reason in case not.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>r</span> <span class=o>*</span><span class=nx>RequestDriverTask</span><span class=p>)</span> <span class=nf>validateRequest</span><span class=p>()</span> <span class=kt>error</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>rClient</span> <span class=o>:=</span> <span class=nx>storages</span><span class=p>.</span><span class=nf>GetRedisClient</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nx>keyValue</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>rClient</span><span class=p>.</span><span class=nf>Get</span><span class=p>(</span><span class=nx>r</span><span class=p>.</span><span class=nx>ID</span><span class=p>).</span><span class=nf>Result</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=c1>// Request has been expired.
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=k>return</span> <span class=nx>ErrExpired</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>isActive</span><span class=p>,</span> <span class=nx>_</span> <span class=o>:=</span> <span class=nx>strconv</span><span class=p>.</span><span class=nf>ParseBool</span><span class=p>(</span><span class=nx>keyValue</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=p>!</span><span class=nx>isActive</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=c1>// Request has been canceled.
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=k>return</span> <span class=nx>ErrCanceled</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// doSearch do search of driver and close to the channel.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=p>(</span><span class=nx>r</span> <span class=o>*</span><span class=nx>RequestDriverTask</span><span class=p>)</span> <span class=nf>doSearch</span><span class=p>(</span><span class=nx>done</span> <span class=kd>chan</span> <span class=kd>struct</span><span class=p>{})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>rClient</span> <span class=o>:=</span> <span class=nx>storages</span><span class=p>.</span><span class=nf>GetRedisClient</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nx>drivers</span> <span class=o>:=</span> <span class=nx>rClient</span><span class=p>.</span><span class=nf>SearchDrivers</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=nx>r</span><span class=p>.</span><span class=nx>Lat</span><span class=p>,</span> <span class=nx>r</span><span class=p>.</span><span class=nx>Lng</span><span class=p>,</span> <span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=nx>drivers</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=c1>// Driver found
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=c1>// Remove driver location, we can send a message to the driver for that it does not send again its location to this service.
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=nx>rClient</span><span class=p>.</span><span class=nf>RemoveDriverLocation</span><span class=p>(</span><span class=nx>drivers</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nx>Name</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>r</span><span class=p>.</span><span class=nx>DriverID</span> <span class=p>=</span> <span class=nx>drivers</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=nx>Name</span>
</span></span><span class=line><span class=cl>		<span class=nb>close</span><span class=p>(</span><span class=nx>done</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>return</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>the function <strong>sendInfo</strong> is just example, you can implement another service or push notification or WebSocket if you want, I want to write another article where I implement an example using FCM with a little library that I wrote <a href=https://github.com/douglasmakey/go-fcm>go-fcm</a> to notify the user.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// sendInfo this func is only example, you can use another services, websocket or push notification for send data to user.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>func</span> <span class=nf>sendInfo</span><span class=p>(</span><span class=nx>r</span> <span class=o>*</span><span class=nx>RequestDriverTask</span><span class=p>,</span> <span class=nx>message</span> <span class=kt>string</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>log</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=s>&#34;Message to user:&#34;</span><span class=p>,</span> <span class=nx>r</span><span class=p>.</span><span class=nx>UserID</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>log</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=nx>message</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Ok, we already have the functions for the search task, now we need to create the new endpoints for our service, we going to create a new folder into handler called &lsquo;v2&rsquo; and inside we create &lsquo;search.go&rsquo;</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// FILE: handler/v2/search.go
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>SearchV2</span><span class=p>(</span><span class=nx>w</span> <span class=nx>http</span><span class=p>.</span><span class=nx>ResponseWriter</span><span class=p>,</span> <span class=nx>r</span> <span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>rClient</span> <span class=o>:=</span> <span class=nx>storages</span><span class=p>.</span><span class=nf>GetRedisClient</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// We use Redis to keep a key unique for each request.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// With this key also we will know if the request is active or if the user canceled the request.
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>requestID</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>rClient</span><span class=p>.</span><span class=nf>Incr</span><span class=p>(</span><span class=s>&#34;request_id&#34;</span><span class=p>).</span><span class=nf>Result</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>key</span> <span class=o>:=</span> <span class=nx>strconv</span><span class=p>.</span><span class=nf>Itoa</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=nx>requestID</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Set true value for the key and also the expiration time, this expiration time is the duration that has the request to find a driver.
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>rClient</span><span class=p>.</span><span class=nf>Set</span><span class=p>(</span><span class=nx>key</span><span class=p>,</span> <span class=kc>true</span><span class=p>,</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Minute</span><span class=o>*</span><span class=mi>4</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>body</span> <span class=o>:=</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>Lat</span><span class=p>,</span> <span class=nx>Lng</span> <span class=kt>float64</span>
</span></span><span class=line><span class=cl>	<span class=p>}{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>json</span><span class=p>.</span><span class=nf>NewDecoder</span><span class=p>(</span><span class=nx>r</span><span class=p>.</span><span class=nx>Body</span><span class=p>).</span><span class=nf>Decode</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>body</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>log</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;could not decode request: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>http</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=s>&#34;could not decode request&#34;</span><span class=p>,</span> <span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// We create a new task and launch with a goroutine.
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>rTask</span> <span class=o>:=</span> <span class=nx>tasks</span><span class=p>.</span><span class=nf>NewRequestDriverTask</span><span class=p>(</span><span class=nx>key</span><span class=p>,</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;requestor_%s&#34;</span><span class=p>,</span> <span class=nx>key</span><span class=p>),</span> <span class=nx>body</span><span class=p>.</span><span class=nx>Lat</span><span class=p>,</span> <span class=nx>body</span><span class=p>.</span><span class=nx>Lng</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>go</span> <span class=nx>rTask</span><span class=p>.</span><span class=nf>Run</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// Return 200 and request_id
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>w</span><span class=p>.</span><span class=nf>WriteHeader</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>w</span><span class=p>.</span><span class=nf>Write</span><span class=p>([]</span><span class=nb>byte</span><span class=p>(</span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>`{&#34;request_id&#34;: %s}`</span><span class=p>,</span> <span class=nx>key</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Next, we create the handler for endpoint &lsquo;v2/cancel&rsquo; to cancel the request, because if the user doesn&rsquo;t want to wait for the search it can cancel the request.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// FILE: handler/v2/search.go
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>CancelRequest</span><span class=p>(</span><span class=nx>w</span> <span class=nx>http</span><span class=p>.</span><span class=nx>ResponseWriter</span><span class=p>,</span> <span class=nx>r</span> <span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>Request</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>rClient</span> <span class=o>:=</span> <span class=nx>storages</span><span class=p>.</span><span class=nf>GetRedisClient</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>body</span> <span class=o>:=</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>RequestID</span> <span class=kt>string</span> <span class=s>`json:&#34;request_id&#34;`</span>
</span></span><span class=line><span class=cl>	<span class=p>}{}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>json</span><span class=p>.</span><span class=nf>NewDecoder</span><span class=p>(</span><span class=nx>r</span><span class=p>.</span><span class=nx>Body</span><span class=p>).</span><span class=nf>Decode</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>body</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>log</span><span class=p>.</span><span class=nf>Printf</span><span class=p>(</span><span class=s>&#34;could not decode request: %v&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=nx>http</span><span class=p>.</span><span class=nf>Error</span><span class=p>(</span><span class=nx>w</span><span class=p>,</span> <span class=s>&#34;could not decode request&#34;</span><span class=p>,</span> <span class=nx>http</span><span class=p>.</span><span class=nx>StatusInternalServerError</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>rClient</span><span class=p>.</span><span class=nf>Set</span><span class=p>(</span><span class=nx>body</span><span class=p>.</span><span class=nx>RequestID</span><span class=p>,</span> <span class=kc>false</span><span class=p>,</span> <span class=nx>time</span><span class=p>.</span><span class=nx>Minute</span><span class=o>*</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>w</span><span class=p>.</span><span class=nf>WriteHeader</span><span class=p>(</span><span class=nx>http</span><span class=p>.</span><span class=nx>StatusOK</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Finally, we need to add new endpoints to our routes.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=c1>// FILE: handler/base.go
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;net/http&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;github.com/douglasmakey/tracking/handler/v2&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>NewHandler</span><span class=p>()</span> <span class=o>*</span><span class=nx>http</span><span class=p>.</span><span class=nx>ServeMux</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>mux</span> <span class=o>:=</span> <span class=nx>http</span><span class=p>.</span><span class=nf>NewServeMux</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nx>mux</span><span class=p>.</span><span class=nf>HandleFunc</span><span class=p>(</span><span class=s>&#34;/tracking&#34;</span><span class=p>,</span> <span class=nx>tracking</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>mux</span><span class=p>.</span><span class=nf>HandleFunc</span><span class=p>(</span><span class=s>&#34;/search&#34;</span><span class=p>,</span> <span class=nx>search</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>//V2
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>mux</span><span class=p>.</span><span class=nf>HandleFunc</span><span class=p>(</span><span class=s>&#34;/v2/search&#34;</span><span class=p>,</span> <span class=nx>v2</span><span class=p>.</span><span class=nx>SearchV2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>mux</span><span class=p>.</span><span class=nf>HandleFunc</span><span class=p>(</span><span class=s>&#34;/v2/cancel&#34;</span><span class=p>,</span> <span class=nx>v2</span><span class=p>.</span><span class=nx>CancelRequest</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>mux</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h1 id=example>Example<a hidden class=anchor aria-hidden=true href=#example>#</a></h1><p>Look up for the nearest driver</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>curl -i --header <span class=s2>&#34;Content-Type: application/json&#34;</span> --data <span class=s1>&#39;{&#34;lat&#34;: -33.44262, &#34;lng&#34;: -70.63054}&#39;</span> http://localhost:8000/v2/search
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>HTTP/1.1 <span class=m>200</span> OK
</span></span><span class=line><span class=cl>Date: Sat, <span class=m>29</span> Sep <span class=m>2018</span> 15:33:48 GMT
</span></span><span class=line><span class=cl>Content-Length: <span class=m>17</span>
</span></span><span class=line><span class=cl>Content-Type: application/json
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>{</span><span class=s2>&#34;request_id&#34;</span>: 1<span class=o>}</span>
</span></span></code></pre></div><p>But if drivers are not close client location and pass 4 minutes or the time duration that we set, the request will be expired without finding any drivers.</p><p>Server Log</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>2018/09/30 01:57:53 Starting HTTP Server. Listening at <span class=s2>&#34;:8000&#34;</span>
</span></span><span class=line><span class=cl>Search Driver - Request <span class=m>1</span> <span class=k>for</span> Lat: -33.442620 and Lng: -70.630540
</span></span><span class=line><span class=cl>Search Driver - Request <span class=m>1</span> <span class=k>for</span> Lat: -33.442620 and Lng: -70.630540
</span></span><span class=line><span class=cl>Search Driver - Request <span class=m>1</span> <span class=k>for</span> Lat: -33.442620 and Lng: -70.630540
</span></span><span class=line><span class=cl>Search Driver - Request <span class=m>1</span> <span class=k>for</span> Lat: -33.442620 and Lng: -70.630540
</span></span><span class=line><span class=cl>Search Driver - Request <span class=m>1</span> <span class=k>for</span> Lat: -33.442620 and Lng: -70.630540
</span></span><span class=line><span class=cl>Search Driver - Request <span class=m>1</span> <span class=k>for</span> Lat: -33.442620 and Lng: -70.630540
</span></span><span class=line><span class=cl>Search Driver - Request <span class=m>1</span> <span class=k>for</span> Lat: -33.442620 and Lng: -70.630540
</span></span><span class=line><span class=cl>Search Driver - Request <span class=m>1</span> <span class=k>for</span> Lat: -33.442620 and Lng: -70.630540
</span></span><span class=line><span class=cl>Message to user:  requestor_1
</span></span><span class=line><span class=cl>Sorry, we did not find any driver.
</span></span></code></pre></div><p>We going to do another request to &lsquo;v2/search&rsquo;, but after 1 minute in another terminal, we send driver location to service.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>// Another Terminal
</span></span><span class=line><span class=cl>curl -i --header <span class=s2>&#34;Content-Type: application/json&#34;</span> --data <span class=s1>&#39;{&#34;id&#34;: &#34;1&#34;, &#34;lat&#34;: -33.44091, &#34;lng&#34;: -70.6301}&#39;</span> http://localhost:8000/tracking
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>// Terminal with main
</span></span><span class=line><span class=cl>2018/09/30 02:12:03 Starting HTTP Server. Listening at <span class=s2>&#34;:8000&#34;</span>
</span></span><span class=line><span class=cl>2018/09/30 02:12:38 Search Driver - Request <span class=m>2</span> <span class=k>for</span> Lat: -33.442620 and Lng: -70.630540
</span></span><span class=line><span class=cl>2018/09/30 02:13:08 Search Driver - Request <span class=m>2</span> <span class=k>for</span> Lat: -33.442620 and Lng: -70.630540
</span></span><span class=line><span class=cl>2018/09/30 02:13:38 Search Driver - Request <span class=m>2</span> <span class=k>for</span> Lat: -33.442620 and Lng: -70.630540
</span></span><span class=line><span class=cl>2018/09/30 02:13:38 Message to user: requestor_2
</span></span><span class=line><span class=cl>2018/09/30 02:13:38 Driver <span class=m>1</span> found
</span></span></code></pre></div><p>Ok, now we going to do another request to &lsquo;v2/search&rsquo;, but this time we going to do a request to &lsquo;v2/cancel&rsquo; to cancel the order because we can not wait.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>// Another Terminal
</span></span><span class=line><span class=cl>curl -i --header <span class=s2>&#34;Content-Type: application/json&#34;</span> --data <span class=s1>&#39;{&#34;request_id&#34;: &#34;3&#34;}&#39;</span> http://localhost:8000/v2/cancel
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>// Terminal with main
</span></span><span class=line><span class=cl>2018/09/30 02:19:24 Starting HTTP Server. Listening at <span class=s2>&#34;:8000&#34;</span>
</span></span><span class=line><span class=cl>2018/09/30 02:19:56 Search Driver - Request <span class=m>3</span> <span class=k>for</span> Lat: -33.442620 and Lng: -70.630540
</span></span><span class=line><span class=cl>2018/09/30 02:19:56 Request <span class=m>3</span> has been canceled.
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.kungfudev.com/tags/go/>go</a></li><li><a href=https://www.kungfudev.com/tags/redis/>redis</a></li><li><a href=https://www.kungfudev.com/tags/tracking/>tracking</a></li><li><a href=https://www.kungfudev.com/tags/services/>services</a></li></ul><nav class=paginav><a class=prev href=https://www.kungfudev.com/posts/health-checks/><span class=title>« Prev</span><br><span>Let's talk about Health Checks</span></a>
<a class=next href=https://www.kungfudev.com/posts/tracking-service-with-go-and-redis/><span class=title>Next »</span><br><span>Tracking Service with Go and Redis</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Tracking Service with Go and Redis V2 on twitter" href="https://twitter.com/intent/tweet/?text=Tracking%20Service%20with%20Go%20and%20Redis%20V2&url=https%3a%2f%2fwww.kungfudev.com%2fposts%2ftracking-service-v2%2f&hashtags=go%2credis%2ctracking%2cservices"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Tracking Service with Go and Redis V2 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fwww.kungfudev.com%2fposts%2ftracking-service-v2%2f&title=Tracking%20Service%20with%20Go%20and%20Redis%20V2&summary=Tracking%20Service%20with%20Go%20and%20Redis%20V2&source=https%3a%2f%2fwww.kungfudev.com%2fposts%2ftracking-service-v2%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Tracking Service with Go and Redis V2 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fwww.kungfudev.com%2fposts%2ftracking-service-v2%2f&title=Tracking%20Service%20with%20Go%20and%20Redis%20V2"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Tracking Service with Go and Redis V2 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.kungfudev.com%2fposts%2ftracking-service-v2%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Tracking Service with Go and Redis V2 on whatsapp" href="https://api.whatsapp.com/send?text=Tracking%20Service%20with%20Go%20and%20Redis%20V2%20-%20https%3a%2f%2fwww.kungfudev.com%2fposts%2ftracking-service-v2%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Tracking Service with Go and Redis V2 on telegram" href="https://telegram.me/share/url?text=Tracking%20Service%20with%20Go%20and%20Redis%20V2&url=https%3a%2f%2fwww.kungfudev.com%2fposts%2ftracking-service-v2%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://www.kungfudev.com>KungFu Developer</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>